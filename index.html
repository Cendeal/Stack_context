<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stack context</title>
    <style>
        div {
            width: 500px;
            height: 30px;
            user-select: none;
        }

        .root {
            height: 500px;
            width: 800px;
            margin-top: 100px;
            background: rgba(26, 255, 214, 0.85);
        }

        .block {
            display: block;
            background: dodgerblue;
            transform: rotate(-35deg);
        }

        .block-inline {
            display: inline-block;
            background: blue;
            transform: rotate(-13deg);
        }

        .float {
            float: left;
            background: green;
            transform: rotate(-69deg);
        }

        .inline {
            display: inline;
            background: greenyellow;
            padding-right: 1000px;
        }

        .z-index-auto {
            z-index: auto;
            background: orange;
            transform: rotate(-56deg);
        }

        .z-index-zero {
            z-index: 0;
            background: oldlace;
            transform: rotate(-139deg);
        }

        .z-index-plus {
            z-index: 1;
            background: red;
            transform: rotate(-110deg);
        }

        .z-index-sub {
            z-index: -1;
            background: purple;
            transform: rotate(-91deg);
        }

        .bottom {
            margin: 25px;
            border-radius: 10px;
            position: fixed;
            max-width: 600px;
            z-index: 9999;
            bottom: 0;
            table-layout: fixed;
            background: rgba(0, 0, 0, 0.5);
            color: white;
        }

    </style>
</head>
<body>
<table class="bottom">
    <tr>
        <td>zIndex的position</td>
        <td>
            <select id="select">
                <option>static</option>
                <option>relative</option>
                <option>absolute</option>
                <option>sticky</option>
            </select>
            <button onclick="setIndexPosition()">确定</button>
        </td>

        <td rowspan="2" id="order"><span style="display: block">拖动切换顺序：<button onclick="change()">确定更换</button></span>
        </td>
    </tr>
    <tr>
        <td>显示/隐藏</td>
        <td id="action"></td>
    </tr>
</table>

<div class="root" id="root" title="0#root">0#root

</div>
<script>
    let moves = ['zIndexPlus', 'zIndexAuto', 'inline', 'inlineBlock', 'float', 'block', 'zIndex0', 'zIndexSub']
    const classes = {
        inline: 'inline',
        inlineBlock: 'block-inline',
        float: 'float',
        block: 'block',
        zIndexPlus: 'z-index-plus z-index',
        zIndex0: 'z-index-zero z-index',
        zIndexSub: 'z-index-sub z-index',
        zIndexAuto: 'z-index-auto z-index'
    }

    function generateDiv(item, i, divs) {
        let temp = document.getElementById(item)
        if (temp) {
            temp.remove()
        }

        let div = document.createElement('div')
        div.innerText = div.title = `#${i}-${item}`
        div.className = classes[item]
        div.id = item
        divs.push(div)
    }

    function init() {
        const root = document.getElementById('root')
        let moveSelectNode = document.getElementById('action')
        let orders = document.getElementById('order')


        let nodes = []
        let divs = []
        let buttons = []

        for (let i = 1; i <= moves.length; i++) {
            let item = moves[i - 1]
            generateDiv(item, i, divs)
            // init checkbox
            let sp_t = document.getElementById(item + 'sp')
            if (sp_t) {
                sp_t.remove()
            }
            let sp = document.createElement('span')
            sp.id = item + 'sp'

            let checkbox = document.createElement('input')
            checkbox.type = 'checkbox'
            checkbox.checked = true
            checkbox.value = item
            checkbox.addEventListener('click', () => {
                const target = document.getElementById(item)
                if (!checkbox.checked && target) {
                    target.style.visibility = 'hidden'
                } else {
                    target.style.visibility = 'visible'
                }
            })

            let span = document.createElement('span')
            span.innerText = `#${i}-${item}`

            //init order button
            const button_t = document.getElementById(`${item}_btn`)
            if (button_t) {
                button_t.remove()
            }
            const button = document.createElement('button')
            button.innerText = `#${i}-${item}`
            button.draggable = true

            button.id = `${item}_btn`
            button.ondrop = (event) => {
                event.preventDefault();
                let data = event.dataTransfer.getData("button")
                console.log(data, 'data');
                let target_button = document.getElementById(data)
                let src_button = event.target
                console.log(src_button)
                swap(target_button, src_button)
            }
            button.ondragover = (event) => {
                event.preventDefault();
            }
            button.ondragstart = (event) => {
                event.dataTransfer.setData("button", event.target.id);
            }
            buttons.push(button)


            sp.append(checkbox, span)
            nodes.push(sp)
        }
        root.append(...divs)
        moveSelectNode.append(...nodes)
        orders.append(...buttons)
    }

    function swap(a, b) {
        let temp = {
            id: a.id,
            innerText: a.innerText
        };
        a.id = b.id
        a.innerText = b.innerText
        b.id = temp.id
        b.innerText = temp.innerText
    }

    function setIndexPosition() {
        const val = document.getElementById('select').value;
        let zIndex = document.getElementsByClassName('z-index')
        for (let item of zIndex) {
            item.style.position = val
        }
    }

    function change() {
        const buttons = document.getElementById('order').querySelectorAll(`button[id$='_btn']`)
        moves = []
        buttons.forEach(button => {
            moves.push(button.id.replace(/_btn/g, ''))
        })
        init()
    }

    init()

</script>
</body>
</html>